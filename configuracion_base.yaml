# =============================================================================
######################### CONFIGURACIÓN BASE ESPHome ##########################
# =============================================================================

# 1. PEGA AQUÍ LA CONFIGURACIÓN BÁSICA DE TU PLACA
# =============================================================================
# INSTRUCCIONES:
# 1. Sube las librerías a la carpeta lib/ de tu Home Assistant como dicta el README.
# 2. Crea un "New Device" en ESPHome y dale a instalar.
# 3. Borra el código generado, copia todo este archivo y pégalo.
# =============================================================================

# =============================================================================

# =============================================================================
# IDENTIFICACIÓN DEL NÚCLEO (No es necesario tocar excepto 'name')
# =============================================================================
esphome:
  # Nombre interno en minúsculas y sin espacios (Ej: "sensor-salon")
  name: poner-nombre-de-dispositivo
  
  # Nombre interno por defecto. IMPORTANTE: Para renombrar el dispositivo una vez 
  # integrado en la casa, ¡hazlo desde los ajustes ⚙️ de la app de Home Assistant! 
  # No hace falta editar este archivo ni volver a compilar.
  friendly_name: ${friendly_name}
  
  # Añadir la dirección MAC al nombre para evitar conflictos si tienes varias placas iguales
  name_add_mac_suffix: true
  min_version: "2026.2.1"
  project:
    name: "poner-nombre-de-proyecto"
    version: ${version}
    on_update:
      - logger.log:
          format: "Firmware actualizado a la versión %s!"
          args: ["version"]
  on_boot:
    priority: 200
    then:
      - lambda: |-
          // Leer si ya tenemos credenciales guardadas
          bool provisioned = id(wifi_provisioned);
          if (!provisioned) {
            ESP_LOGI("boot", "Primera vez: sin credenciales WiFi, esperando Improv BLE...");
          } else {
            ESP_LOGI("boot", "Credenciales ya guardadas, conectando WiFi...");
          }

preferences:
  flash_write_interval: 1s

# -----------------------------------------------------------------------------
# CONFIGURACIÓN DE PLACA (Pega la que generó ESPHome o descomenta SOLO UNA)
# -----------------------------------------------------------------------------

# --- OPCIÓN 1: ESP32 estándar (DevKitC, NodeMCU-32S, etc.) ---
# esp32:
#   board: esp32dev
#   framework:
#     type: arduino
# psram:                       # <--- Descomentar si tu modelo ESP32 (WROVER, etc...) tiene PSRAM física.
# substitutions:
#   friendly_name: "Sin Configurar"    # (Se renombra luego desde los ajustes de Home Assistant)
#   version: "0.0.1"             # <--- CAMBIA LA VERSIÓN AQUÍ
#   pin_led_estado: "2"          # <--- Pin del LED integrado (ESP32 normal suele ser 2)
#   pin_led_invertido: "false"
#   umbral_ram_grave: "20000"
#   umbral_ram_moderada: "50000"
#   umbral_loop_time: "500"
#   umbral_cpu_freq_max: "239000000"

# --- OPCIÓN 2: ESP32-C3 Super Mini (Por Defecto) ---
esp32:
  board: esp32-c3-devkitm-1
  framework:
    type: esp-idf
substitutions:
  friendly_name: "Sin Configurar"    # (Se renombra luego desde los ajustes de Home Assistant)
  version: "0.0.1"             # <--- CAMBIA LA VERSIÓN AQUÍ
  pin_led_estado: "8"          # <--- Pin del LED integrado (ESP32-C3 Super Mini suele ser 8)
  pin_led_invertido: "true"    # <--- true si el LED enciende en pulso bajo (Super Mini es Invertido)
  umbral_ram_grave: "20000"
  umbral_ram_moderada: "50000"
  umbral_loop_time: "500"
  umbral_cpu_freq_max: "161000000"

# --- OPCIÓN 3: ESP8266 (D1 Mini, NodeMCU, etc.) ---
# esp8266:
#   board: d1_mini
# substitutions:
#   friendly_name: "Sin Configurar"    # (Se renombra luego desde los ajustes de Home Assistant)
#   version: "0.0.1"             # <--- CAMBIA LA VERSIÓN AQUÍ
#   pin_led_estado: "2"          # <--- Pin del LED integrado (NodeMCU/D1 Mini suele ser 2)
#   pin_led_invertido: "true"    # <--- NodeMCU enciede con LOW
#   umbral_ram_grave: "8000"
#   umbral_ram_moderada: "15000"
#   umbral_loop_time: "1000"
#   umbral_cpu_freq_max: "159000000"

logger:

debug:

api:
  # Borrada la encriptación manual de la API, se usa el emparejamiento interno nativo.
  reconnect_timeout: 0s

ota:
  - platform: esphome

captive_portal:


# =============================================================================
# 2. INCLUYE LOS PAQUETES DE "ESPHome Professional Packages"
# =============================================================================

packages:
  # --- MÓDULOS OBLIGATORIOS (Para todo dispositivo) ---
  wifi: !include lib/lib-wifi_conectividad.yaml
  alarmas: !include lib/lib-estados_alarmas.yaml
