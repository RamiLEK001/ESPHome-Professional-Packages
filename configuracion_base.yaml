# =============================================================================
# üì¶ ESPHome Professional Packages - INSTRUCCIONES DE USO
# =============================================================================
# 1. Sube la carpeta "lib/" (que contiene los archivos .yaml) a tu 
#    servidor Home Assistant dentro de la carpeta /config/esphome/
# 2. Crea un "New Device" en ESPHome y dale a instalar para que genere las keys.
# 3. Borra el c√≥digo generado por defecto, copia todo este archivo y p√©galo.
# 4. Modifica EXCLUSIVAMENTE las secciones marcadas como "CONFIGURA AQU√ç".
# =============================================================================

# =============================================================================
# 1. IDENTIFICACI√ìN DEL N√öCLEO (Solo modificar 'name', 'friendly_name', 'project')
# =============================================================================
esphome:
  # -> CONFIGURA AQU√ç: Nombre interno a nivel de programaci√≥n (ej: "luz-comedor")
  name: poner-nombre-de-dispositivo
  
  # -> CONFIGURA AQU√ç: Nombre amigable (ej: "Luz Comedor Principal")
  # IMPORTANTE: Si integras el dispositivo en Home Assistant, ren√≥mbralo
  # desde los ajustes de la propia app de HA. ¬°No cambies esto de nuevo aqu√≠!
  friendly_name: ${friendly_name}
  
  # A√±ade la direcci√≥n MAC f√≠sica al nombre. Vital si produces placas en masa ("luz-comedor-1AFF42")
  name_add_mac_suffix: true
  
  # Requiere al menos esta versi√≥n de ESPHome para compilar los scripts modernos
  min_version: "2026.2.1"
  
  project:
    # -> CONFIGURA AQU√ç: Desde v2026 es OBLIGATORIO usar un namespace (autor.dispositivo)
    name: "mi_casa.dispositivo_nuevo"
    version: ${version}
    on_update:
      - logger.log:
          format: "Firmware actualizado a la versi√≥n %s!"
          args: ["version"]
  on_boot:
    priority: 200
    then:
      - lambda: |-
          // Leer si ya tenemos credenciales guardadas
          bool provisioned = id(wifi_provisioned);
          if (!provisioned) {
            ESP_LOGI("boot", "Primera vez: sin credenciales WiFi, esperando Improv BLE...");
          } else {
            ESP_LOGI("boot", "Credenciales ya guardadas, conectando WiFi...");
          }

preferences:
  flash_write_interval: 1s

# -----------------------------------------------------------------------------
# 2. SELECCI√ìN DE HARDWARE (Descomenta √öNICAMENTE el bloque de tu placa)
# -----------------------------------------------------------------------------

# ‚ùå OPCI√ìN 1: ESP32 Est√°ndar (WROOM-32, DevKitC, NodeMCU-32S) 
# -> Instrucciones: Quita todas las almohadillas (#) a la izquierda de estas 12 l√≠neas
# esp32:
#   board: esp32dev
#   framework:
#     type: arduino
# psram:                       # <- Solo si tu chip tiene PSRAM externa real
# substitutions:
#   friendly_name: "Sin Configurar"    
#   version: "0.0.1"             # <- Vuelca aqu√≠ el versionado de tu proyecto
#   pin_led_estado: "2"          # <- Pin del LED f√≠sico integrado azul (Suele ser 2 o 1)
#   pin_led_invertido: "false"   # <- Enciende cuando hay voltaje (High)
#   umbral_ram_grave: "20000"    # <- Bytes de RAM libres antes de entrar en p√°nico cr√≠tico
#   umbral_ram_moderada: "50000"
#   umbral_loop_time: "500"      # <- Milisegundos de latencia antes de quejarse de lentitud

# ‚úÖ OPCI√ìN 2: ESP32-C3 Super Mini (ACTIVADO POR DEFECTO)
# -> Instrucciones: Arquitectura RISC-V compacta de alto rendimiento.
esp32:
  board: esp32-c3-devkitm-1
  framework:
    type: esp-idf
substitutions:
  friendly_name: "Sin Configurar"    
  version: "0.0.1"             
  pin_led_estado: "8"          # <- Pin del LED azul (8 en la Super Mini)
  pin_led_invertido: "true"    # <- Enciende cuando se corta el voltaje (Low - Invertido)
  umbral_ram_grave: "20000"
  umbral_ram_moderada: "50000"
  umbral_loop_time: "500"

# ‚ùå OPCI√ìN 3: Familia ESP8266 (wemos D1 Mini, NodeMCU v2/v3, Sonoff)
# -> Instrucciones: Quita todas las almohadillas (#) a la izquierda de estas l√≠neas
# -> OJO: Ve al componente 'sensor' en lib-estados_alarmas.yaml y BORRA 'internal_temperature' 
# -> porque el ESP8266 no tiene sensor t√©rmico interno f√≠sico, o dar√° error de compilaci√≥n.
# esp8266:
#   board: d1_mini
# substitutions:
#   friendly_name: "Sin Configurar"   
#   version: "0.0.1"             
#   pin_led_estado: "2"          # <- Pin del LED azul
#   pin_led_invertido: "true"    # <- Enciende cuando se corta el voltaje al igual que C3
#   umbral_ram_grave: "8000"     # <- El ESP8266 tiene menos RAM por dise√±o, los umbrales bajan
#   umbral_ram_moderada: "15000"
#   umbral_loop_time: "1000"

# =============================================================================
# 3. MOTORES NATIVOS Y SERVICIOS ESPHOME (No editar a menos que seas avanzado)
# =============================================================================
logger:

debug:

api:
  # Borrada la encriptaci√≥n manual de la API, se usa el emparejamiento interno nativo.
  reboot_timeout: 0s

ota:
  - platform: esphome

captive_portal:


# =============================================================================
# 2. INCLUYE LOS PAQUETES DE "ESPHome Professional Packages"
# =============================================================================

packages:
  # --- M√ìDULOS OBLIGATORIOS (Para todo dispositivo) ---
  wifi: !include lib/lib-wifi_conectividad.yaml
  alarmas: !include lib/lib-estados_alarmas.yaml
