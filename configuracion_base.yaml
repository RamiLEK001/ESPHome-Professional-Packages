# =============================================================================
######################### CONFIGURACIÓN BASE ESPHome ##########################
# =============================================================================

# 1. PEGA AQUÍ LAS VARIABLES GENERADAS POR ESPHOME (esphome:, api:, ota.)
# =============================================================================
# INSTRUCCIONES:
# 1. Entra a tu Dashboard de ESPHome a través de la app de Home Assistant (ej: http://homeassistant.local:8123)
# 2. Haz clic en "New Device" y sigue el asistente básico.
# 3. Abre el archivo .yaml (Edit) que ESPHome acaba de crear.
# 4. Copia los bloques de 'api:' (tu key de encriptación) y 'ota:' (tu password).
# 5. Pégalos aquí reemplazando los valores de ejemplo de abajo.
 
# IMPORTANTE: Nunca compartas tu api key ni ota password.
# No borres el campo 'reconnect_timeout: 0s', es vital para la estabilidad.
# =============================================================================


substitutions:
  # Versión de tu código interno (Auméntalo cada vez que le añadas algo nuevo a este aparato)
  version: "0.0.1"

# =============================================================================
# IDENTIFICACIÓN DEL NÚCLEO (No es necesario tocar excepto 'name')
# =============================================================================
esphome:
  # Nombre interno en minúsculas y sin espacios (Ej: "sensor-salon")
  name: "poner-nombre-de-dispositivo"
  
  # Nombre interno por defecto. IMPORTANTE: Para renombrar el dispositivo una vez 
  # integrado en la casa, ¡hazlo desde los ajustes ⚙️ de la app de Home Assistant! 
  # No hace falta editar este archivo ni volver a compilar.
  friendly_name: "Sin Configurar"
  
  # Añadir la dirección MAC al nombre para evitar conflictos si tienes varias placas iguales
  name_add_mac_suffix: true
  project:
    name: "ESPHome Pro.Telemetria"
    version: ${version}
  on_update:
    - logger.log: "¡Firmware actualizado a la versión ${version}!"

  on_boot:
    priority: 200
    then:
      - lambda: |-
          // Leer si ya tenemos credenciales guardadas
          bool provisioned = id(wifi_provisioned);
          if (!provisioned) {
            ESP_LOGI("boot", "Primera vez: sin credenciales WiFi, esperando Improv BLE...");
          } else {
            ESP_LOGI("boot", "Credenciales ya guardadas, conectando WiFi...");
          }

preferences:
  flash_write_interval: 1s

# -----------------------------------------------------------------------------
# CONFIGURACIÓN DE PLACA (Pega la que generó ESPHome o descomenta SOLO UNA)
# -----------------------------------------------------------------------------

# --- OPCIÓN 1: ESP32 estándar (DevKitC, NodeMCU-32S, etc.) ---
# esp32:
#   board: esp32dev
#   framework:
#     type: arduino
# substitutions:
#   umbral_ram_grave: "20000"
#   umbral_ram_moderada: "50000"
#   umbral_loop_time: "500"
#   umbral_cpu_freq_max: "239000000"

# --- OPCIÓN 2: ESP32-C3 Super Mini (Por Defecto) ---
esp32:
  board: esp32-c3-devkitm-1
  framework:
    type: esp-idf
substitutions:
  umbral_ram_grave: "20000"
  umbral_ram_moderada: "50000"
  umbral_loop_time: "500"
  umbral_cpu_freq_max: "159000000"

# --- OPCIÓN 3: ESP8266 (D1 Mini, NodeMCU, etc.) ---
# esp8266:
#   board: d1_mini
# substitutions:
#   umbral_ram_grave: "8000"
#   umbral_ram_moderada: "15000"
#   umbral_loop_time: "1000"
#   umbral_cpu_freq_max: "159000000"

logger:

api:
  encryption:
    key: "TU_API_KEY_GENERADA_AQUI="  # <--- PEGA TU API KEY AQUÍ
  reconnect_timeout: 0s

ota:
  - platform: esphome
    password: "TU_OTA_PASSWORD_GENERADO_AQUI"  # <--- PEGA TU OTA PASSWORD AQUÍ

captive_portal:


# =============================================================================
# 2. INCLUYE LOS PAQUETES DE "ESPHome Professional Packages"
# =============================================================================

packages:
  # --- MÓDULOS OBLIGATORIOS (Para todo dispositivo) ---
  wifi: !include lib-wifi_conectividad.yaml
  alarmas: !include lib-estados_alarmas.yaml
